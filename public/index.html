<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cartelera Cines Madrid</title>
<style>
  body{font-family:system-ui;margin:0;padding:24px;background:#f6f7f9}
  h2{margin:0 0 12px}
  #grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
  article{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.05)}
  img{width:100%;border-radius:8px;background:#f2f2f2;aspect-ratio:2/3;object-fit:cover;margin-bottom:8px}
</style>
</head>
<body>
  <h2>ðŸŽ¬ Cartelera real â€” Cines Madrid</h2>
  <div id="grid">Cargandoâ€¦</div>
  <script>
  (async()=>{
    const BASE = ""; // JSON servidos por el mismo Pages (copiamos data/ a public/)
    const enriched = BASE + "/data/enriched/madrid-cartelera.json";
    const basic    = BASE + "/data/madrid-cartelera.json";
    const ph = "https://via.placeholder.com/300x450?text=Sin+Imagen";
    const grid = document.getElementById("grid");
    try{
      let j;
      try {
        const r = await fetch(enriched,{cache:"no-store"}); if(!r.ok) throw 0;
        j = await r.json(); if(!Array.isArray(j.movies)||!j.movies.length) throw 0;
        grid.innerHTML = j.movies.map(m=>`
          <article>
            <img src="${m.poster||ph}" alt="${m.title}"><h3>${m.title}</h3>
            ${m.overview?`<p>${m.overview}</p>`:""}
          </article>`).join("");
      } catch {
        const r2 = await fetch(basic,{cache:"no-store"}); if(!r2.ok) throw new Error("No pude cargar JSON");
        const j2 = await r2.json(); const titles = [...new Set(j2.titles||[])];
        grid.innerHTML = titles.map(t=>`
          <article>
            <img src="${ph}" alt="${t}"><h3>${t}</h3>
          </article>`).join("");
      }
    } catch(e){ grid.innerHTML = `<p style="color:#b00020">Error: ${e.message||e}</p>`; }
  })();
  </script>
</body>
</html>
